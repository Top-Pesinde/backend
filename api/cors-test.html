<!DOCTYPE html>
<html>
<head>
    <title>CORS Test</title>
</head>
<body>
    <h1>CORS Test</h1>
    <div id="status">Testing...</div>
    <div id="log"></div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(message) {
            console.log(message);
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }
        
        log('ğŸ”Œ Socket.IO baÄŸlantÄ±sÄ± test ediliyor...');
        
        // Ã–nce basit bir fetch testi
        fetch('http://localhost:3000/health')
            .then(response => response.json())
            .then(data => {
                log('âœ… HTTP baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±: ' + JSON.stringify(data));
                
                // Åimdi Socket.IO'yu test et
                testSocket();
            })
            .catch(error => {
                log('âŒ HTTP baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z: ' + error.message);
                statusDiv.textContent = 'HTTP baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z';
            });
        
        function testSocket() {
            log('ğŸ”Œ Socket.IO test baÅŸlÄ±yor...');
            
            const socket = io('http://localhost:3000', {
                transports: ['polling', 'websocket'],
                forceNew: true,
                timeout: 10000
            });
            
            socket.on('connect', () => {
                log('âœ… Socket.IO baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!');
                statusDiv.textContent = 'Socket.IO baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!';
                statusDiv.style.color = 'green';
                
                // Test mesajÄ± gÃ¶nder
                socket.emit('ping', { test: true });
            });
            
            socket.on('connect_error', (error) => {
                log('âŒ Socket.IO baÄŸlantÄ± hatasÄ±: ' + error.message);
                statusDiv.textContent = 'Socket.IO baÄŸlantÄ± hatasÄ±: ' + error.message;
                statusDiv.style.color = 'red';
            });
            
            socket.on('pong', (data) => {
                log('ğŸ“ Pong alÄ±ndÄ±: ' + JSON.stringify(data));
            });
            
            socket.on('disconnect', (reason) => {
                log('ğŸ”Œ BaÄŸlantÄ± kesildi: ' + reason);
            });
            
            // 5 saniye sonra baÄŸlantÄ±yÄ± test et
            setTimeout(() => {
                if (socket.connected) {
                    log('âœ… Socket hala baÄŸlÄ±');
                } else {
                    log('âŒ Socket baÄŸlantÄ±sÄ± kesildi');
                }
            }, 5000);
        }
    </script>
</body>
</html>